<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

</head>

<body>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 80%;
            margin: 0 auto;
        }

        .table {
            width: 100%;
            background-color: #fff;
            margin-bottom: 20px;
            border-collapse: collapse;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .table th {
            background-color: #007bff;
            color: #fff;
        }

        .table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .table tr:hover {
            background-color: #f1f1f1;
        }

        .filterable {
            margin-top: 15px;
        }

        .filterable .panel-heading .pull-right {
            margin-top: -20px;
        }

        .filterable .filters input[disabled] {
            background-color: transparent;
            border: none;
            cursor: auto;
            box-shadow: none;
            padding: 0;
            height: auto;
        }

        .filterable .filters input[disabled]::-webkit-input-placeholder {
            color: #333;
        }

        .filterable .filters input[disabled]::-moz-placeholder {
            color: #333;
        }

        .filterable .filters input[disabled]:-ms-input-placeholder {
            color: #333;
        }
    </style>

    <br>
    <h2>Listing of All Task</h2>
    <hr><br>
    <div class="container">
        <div class="row">
            <!-- <table class="table">
                <thead>
                    <tr class="filters">
                        <th>Assigned User
                            <select id="assigned-user-filter" class="form-control">
                                <option>None</option>
                                <option>John</option>
                                <option>Rob</option>
                                <option>Larry</option>
                                <option>Donald</option>
                                <option>Roger</option>
                            </select>
                        </th>
                        <th>Status
                            <select id="status-filter" class="form-control">
                                <option>Any</option>
                                <option>Not Started</option>
                                <option>In Progress</option>
                                <option>Completed</option>
                            </select>
                        </th>
                        <th>Milestone
                            <select id="milestone-filter" class="form-control">
                                <option>None</option>
                                <option>Milestone 1</option>
                                <option>Milestone 2</option>
                                <option>Milestone 3</option>
                            </select>
                        </th>
                        <th>Priority
                            <select id="priority-filter" class="form-control">
                                <option>Any</option>
                                <option>Low</option>
                                <option>Medium</option>
                                <option>High</option>
                                <option>Urgent</option>
                            </select>
                        </th>
                        <th>Tags
                            <select id="tags-filter" class="form-control">
                                <option>None</option>
                                <option>Tag 1</option>
                                <option>Tag 2</option>
                                <option>Tag 3</option>
                            </select>
                        </th>
                    </tr>
                </thead>
            </table> -->


            <div class="panel panel-primary filterable">
                <div class="panel-heading">
                    <h3 class="panel-title">Tasks</h3>
                    <div class="pull-right"></div>
                </div>

                <table id="task-list-tbl" class="table">
                    <thead>
                        <tr>
                            <th>Task Id</th>
                            <th>Title</th>
                            <th>description</th>
                            <th>Due Date</th>

                        </tr>
                    </thead>

                    <!-- <tbody>

                        <tr id="task-1" class="task-list-row" data-task-id="1" data-user="Larry"
                            data-status="In Progress" data-milestone="Milestone 2" data-priority="Urgent"
                            data-tags="Tag 2">
                            <td>Task title 1</td>
                            <td>01/24/2015</td>
                            <td>09/24/2015</td>
                            <td>Urgent</td>
                            <td>Milestone 2</td>
                            <td>Larry</td>
                            <td>Tag 2</td>
                        </tr>

                        <tr id="task-2" class="task-list-row" data-task-id="2" data-user="Larry"
                            data-status="Not Started" data-milestone="Milestone 2" data-priority="Low"
                            data-tags="Tag 1">
                            <td>Task title 2</td>
                            <td>03/14/2015</td>
                            <td>09/18/2015</td>
                            <td>Low</td>
                            <td>Milestone 2</td>
                            <td>Larry</td>
                            <td>Tag 1</td>
                        </tr>

                        <tr id="task-3" class="task-list-row" data-task-id="3" data-user="Donald"
                            data-status="Not Started" data-milestone="Milestone 1" data-priority="Low"
                            data-tags="Tag 3">
                            <td>Task title 3</td>
                            <td>11/16/2014</td>
                            <td>02/29/2015</td>
                            <td>Low</td>
                            <td>Milestone 1</td>
                            <td>Donald</td>
                            <td>Tag 3</td>
                        </tr>


                        <tr id="task-4" class="task-list-row" data-task-id="4" data-user="Donald"
                            data-status="Completed" data-milestone="Milestone 1" data-priority="High" data-tags="Tag 1">
                            <td>Task title 4</td>
                            <td>11/16/2014</td>
                            <td>02/29/2015</td>
                            <td>High</td>
                            <td>Milestone 1</td>
                            <td>Donald</td>
                            <td>Tag 1</td>
                        </tr>
                    </tbody> -->

                    <tbody id="task-4" class="task-list-row" data-task-id="4" data-user="Donald" data-status="Completed"
                        data-milestone="Milestone 1" data-priority="High" data-tags="Tag 1">
                        <% tasks.forEach(task=> { %>
                            <tr>
                                <td>
                                    <%= task._id %>
                                </td>
                                <td>
                                    <%= task.title %>
                                </td>
                                <td>
                                    <%= task.description %>
                                </td>
                                <td>
                                    <%= new Date(task.due_date).toLocaleDateString('en-US', { weekday: 'short' ,
                                        month: 'short' , day: '2-digit' , year: 'numeric' }) %>
                                </td>
                            </tr>
                            <% }); %>
                    </tbody>
                </table>



            </div>
        </div>


        <div>
            <form action="/api/UpdateTasks" method="post">
                <!-- <input type="text" id="title" name="title" placeholder="title" required>
                <input type="text" id="description" name="description" placeholder="description" required>

                <input type="text" id="status" name="status" placeholder="status" required>
                <br />
                <label for="dele_date">Due Date</label>
                <input type="date" id="due_date" name="due_date" placeholder="due_date" required> -->


                <select id="assigned-user-filter" class="form-control">
                    <option>None Selected</option>
                    <% const uniqueTaskIds=new Set(); %>
                        <% tasks.forEach(taskGroup=> { %>
                            <% taskGroup.forEach(subtask=> { %>
                                <% if (subtask.task_id && !uniqueTaskIds.has(subtask.task_id)) { %>
                                    <% uniqueTaskIds.add(subtask.task_id); %>
                                        <option>
                                            <%= subtask.task_id %>
                                        </option>
                                        <% } %>
                                            <% }); %>
                                                <% }); %>
                </select>

                <button type="submit">Update</button>
            </form>

        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"
        integrity="sha512-+k1pnlgt4F1H8L7t3z95o3/KO+o78INEcXTbnoJQ/F2VqDVhWoaiVml/OEHv9HsVgxUaVW+IbiZPUJQfF/YxZw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        var filters = {
            title: null,
            description: null,
            due_date: null,
        };

        function updateFilters() {
            $('.task-list-row').hide().filter(function () {
                var
                    self = $(this),
                    result = true; // not guilty until proven guilty

                Object.keys(filters).forEach(function (filter) {
                    if (filters[filter] && (filters[filter] != 'None') && (filters[filter] != 'Any')) {
                        result = result && filters[filter] === self.data(filter);
                    }
                });

                return result;
            }).show();
        }

        function changeFilter(filterName) {
            filters[filterName] = this.value;
            updateFilters();
        }

        // Assigned User Dropdown Filter
        $('#assigned-user-filter').on('change', function () {
            changeFilter.call(this, 'user');
        });

        // Task Status Dropdown Filter
        $('#status-filter').on('change', function () {
            changeFilter.call(this, 'status');
        });

        // Task Milestone Dropdown Filter
        $('#milestone-filter').on('change', function () {
            changeFilter.call(this, 'milestone');
        });

        // Task Priority Dropdown Filter
        $('#priority-filter').on('change', function () {
            changeFilter.call(this, 'priority');
        });

        // Task Tags Dropdown Filter
        $('#tags-filter').on('change', function () {
            changeFilter.call(this, 'tags');
        });


        // future use for a text input filter
        $('#search').on('click', function () {
            $('.box').hide().filter(function () {
                return $(this).data('order-number') == $('#search-criteria').val().trim();
            }).show();
        });
    </script>
</body>

</html>